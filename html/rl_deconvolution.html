<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BoltView: Richardson-Lucy Deconvolution</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BoltView
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('rl_deconvolution.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Richardson-Lucy Deconvolution </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p float="left" align="center"></p>
<p><img src="./blurred_bee.png" alt="Blurred image" title="Blurred image" height="300" class="inline"/> <img src="./rl_deconvolved_bee.jpg" alt="Deconvolved image" title="Deconvolved image" height="300" class="inline"/> </p>
<p>We will show another deconvolution algorithm, which can be used for image restoration, this time all computations will be done in spatial domain, so we will not be needing the Fourier transformation.</p>
<p>The important assumptions are that the image was corrupted by <em>point spread function (PSF)</em> and additive white noise noise.</p>
<p>Standard Richardson-Lucy deconvolution algorithm is not a blind deconvolution algorithm, so we need to know in advance the point spread function, which blurred the input image.</p>
<p float="left" align="center"></p>
<p><img src="./kernel2.png" alt="PSF" title="PSF" height="100" class="inline"/> </p>
<p>We prepare the PSF and its flipped version on GPU, so we can use them later:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">DynamicDeviceKernel&lt;float, 2&gt; psf(host_psf);</div>
<div class="line">DynamicDeviceKernel&lt;float, 2&gt; psf_hat(flipConvolutionKernel(host_psf));</div>
</div><!-- fragment --><p>RL-deconvolution is an iterative algorithm. In our example we will run it for fixed amount of step, but in a real application a little more advanced stopping criterion should be devised and the iteration limit should be present only as a fallback to prevent extremely long computations.</p>
<p>Equation for single step of RL-deconvolution can be seen in following equation, where <code>d</code> is the observed corrupted image and <code>P</code> is the point spread function. Convolutions with PSF and its flipped version are computed over the whole domain, arithmetic operations (multiplications, divisions) are computed per pixel.</p>
<p float="left" align="center"></p>
<p><object type="image/svg+xml" data="./equation.svg" style="pointer-events: none;" title="One iteration" height="50">One iteration</object> </p>
<p>For the implementation we will prepare images on GPU in which we will store the input, current estimate and additional images to store the temporary results.</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">DeviceImage&lt;float, 2&gt; d_image(im.size());</div>
<div class="line">DeviceImage&lt;float, 2&gt; estimate(im.size());</div>
<div class="line">DeviceImage&lt;float, 2&gt; tmp(im.size());</div>
<div class="line">DeviceImage&lt;float, 2&gt; tmp2(im.size());</div>
<div class="line">copy(im, view(d_image));</div>
<div class="line">copy(constView(d_image), view(estimate));</div>
</div><!-- fragment --><p>Actual implementation of the equation is pretty straight forward.</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">for (int i = 0; i &lt; kIterationCount; ++i) {</div>
<div class="line">    convolution(constView(estimate), view(tmp), psf);</div>
<div class="line">    copy(constView(d_image) / constView(tmp), view(tmp));</div>
<div class="line">    convolution(constView(tmp), view(tmp2), psf_hat);</div>
<div class="line">    copy(constView(tmp2) * constView(estimate), view(estimate));</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code><a class="el" href="namespacebolt.html#a85276c6064147612bf795c7fda945a9d">convolution()</a></code> function does a straight forward convolution of input image view (first parameter) and convolution kernel (third parameter) the result is stored in writable image view (second parameter). Multiplication and deletion construct a wrapper image view, which implements a lazy evaluation - the actual pixel values are computed on demand, such as the copy function in this example. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
